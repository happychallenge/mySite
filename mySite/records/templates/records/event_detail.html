{% extends "base.html" %}
{% load static %}


{% block header-index %}
    {% include 'title.html' %}
{% if user.is_authenticated %}
    <a href="{% url 'records:check_person' %}"> 
            <button type='button' class='btn btn-primary pull-right'>사람/시건/뉴스 등록</button>
    </a>
{% endif %}
    <ol class="breadcrumb">
        <li>
            <a href="{% url 'home' %}"> <i class="fa fa-home"></i> Home </a> 
        </li>
        <li>
            <a>Event</a>
        </li>
        <li class="active">
            <strong>Detail</strong>
        </li>
    </ol>
{% endblock header-index %}


{% block content %}
    <div class="wrapper wrapper-content">
        <div class="row animated fadeInRight">
    
            {# Event Infomation #}
            <div class="col-md-4">
                {% include 'records/partial/event_info.html' %}
            </div>

            {# Person Evidence #}
            <div class="col-md-8">
            
                <div class="ibox float-e-margins">
                    {# Event Title  #}
                    <div class="ibox-title">
                        <h4> <strong>{{ event.name }}</strong> 관련된 사람들 </h4>
                        
                    </div>

                    <div class="ibox-content">
                    {# Person Evidence List  #}
                    {% for person in event.person_list %}
                    {# New Content  #}
                        {% include 'records/partial/event_persons.html' with person=person %}
                    {% endfor %}
                    </div>
                
                </div>

            </div>
        </div>
    </div>
{% endblock content %}

{% block javascript %}
<script type='text/javascript'>

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    $(".btnEventLike").click(function(){
        $.ajax({
            url : "{% url 'records:ajax_event_like' event.id %}", 
            type: "POST",
            data: {'csrfmiddlewaretoken': csrftoken},
            dataType : 'json',
            success: function(data){
                if(data.status) {
                    $('.btnEventLike').html(data.like == 'like' ? 'Like<span class="count">(<span class="likes">  </span>)</span>':'<i class="fa fa-thumbs-up"></i>UnLike<span class="count">(<span class="likes"></span>)</span>');
                    $('span.count .likes').text(data.total_likes);
                }
            }
        });
    });

    $("button.btnEventFollowing").click(function(e){
        e.preventDefault();
        $.ajax({
            url : "{% url 'records:ajax_event_following' event.id %}", 
            type: "POST",
            data: {'csrfmiddlewaretoken': csrftoken},
            dataType : 'json',
            success: function(data){
                if(data.status) {
                    $('.btnEventFollowing').html(data.follow == 'following' ? 'Follow<span class="count">(<span class="follow">  </span>)</span>':'<i class="fa fa-thumbs-up"></i>following<span class="count">(<span class="follow"> </span>)</span>');
                    $('span.count .follow').text(data.total_following);
                    alert(data.message);
                }
            }
        });
    });
</script>
{% endblock javascript %}
